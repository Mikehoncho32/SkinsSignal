import {getEnv} from "@/lib/env"; export type Listing={price?:number;stickers?:any[];sticker_premium_pct?:number|null;float?:number|null;paintseed?:number|null}; export async function fetchListings(name:string):Promise<Listing[]>{const {CSFLOAT_API_KEY}=getEnv(); if(!CSFLOAT_API_KEY) return []; const url=`https://csfloat.com/api/v1/listings?market_hash_name=${encodeURIComponent(name)}`; const r=await fetch(url,{headers:{"x-api-key":CSFLOAT_API_KEY},cache:"no-store"}); if(!r.ok) return []; const d=await r.json().catch(()=>null); const arr=Array.isArray(d)?d:Array.isArray(d?.results)?d.results:[]; return arr.map((it:any)=>({price:Number(it.price??it.list_price??it.amount)||undefined,stickers:it.stickers||it.applied_stickers||undefined,sticker_premium_pct:("sticker_premium_pct" in it)?Number(it.sticker_premium_pct):(("sticker_premium" in it)?Number(it.sticker_premium):null),float:it.float??null,paintseed:it.paintseed??it.paint_seed??null})) }
