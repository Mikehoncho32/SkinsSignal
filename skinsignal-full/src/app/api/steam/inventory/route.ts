import {NextResponse} from "next/server"; import {normalizeSteamId} from "@/lib/steam"; export const runtime="nodejs"; export const dynamic="force-dynamic"; export async function GET(req:Request){ const {searchParams}=new URL(req.url); const raw=String(searchParams.get("steamId")||""); try{ const id=normalizeSteamId(raw); const url=`https://steamcommunity.com/inventory/${id}/730/2?l=en&count=5000`; const r=await fetch(url,{cache:"no-store"}); const status=r.status; const text=await r.text().catch(()=>"<no-body>"); try{ return NextResponse.json({ok:status===200,status,json:JSON.parse(text)}) } catch{ return NextResponse.json({ok:status===200,status,text:text.slice(0,1000)}) } } catch(e:any){ return NextResponse.json({ok:false,error:e?.message||"invalid_request"},{status:400}) } }
